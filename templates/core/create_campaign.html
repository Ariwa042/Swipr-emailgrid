{% extends 'base.html' %}

{% block title %}Create Email Campaign - EmailGrid{% endblock %}

{% block content %}
<div class="min-vh-100 py-5" style="background: linear-gradient(135deg, #f8fafc 0%, #e0f2fe 100%);">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8 col-xl-7">
                <!-- Header -->
                <div class="text-center mb-5">
                    <div class="d-inline-flex align-items-center justify-content-center rounded-circle bg-primary bg-gradient text-white mb-4" style="width: 80px; height: 80px;">
                        <i class="bi bi-plus-circle-fill fs-1"></i>
                    </div>
                    <h2 class="fw-bold text-primary mb-2">Create New Campaign</h2>
                    <p class="text-muted fs-5">Launch your next email marketing campaign with precision and style</p>
                </div>

                <!-- Campaign Form -->
                <div class="card shadow-xl border-0 rounded-4">
                    <div class="card-header bg-primary bg-gradient text-white p-4 rounded-top-4">
                        <h5 class="mb-0 d-flex align-items-center">
                            <i class="bi bi-envelope-paper-fill me-3"></i>Campaign Details
                        </h5>
                    </div>
                    <div class="card-body p-5">
                        <form method="post" id="campaign-form" class="needs-validation" novalidate>
                            {% csrf_token %}
                            
                            <!-- Recipient Email -->
                            <div class="mb-4">
                                <label for="{{ form.recipient_email.id_for_label }}" class="form-label fw-semibold text-dark fs-6">
                                    <i class="bi bi-person-fill-check me-2 text-primary"></i>Target Recipient
                                </label>
                                <div class="input-group input-group-lg">
                                    <span class="input-group-text bg-light border-end-0 rounded-start-3">
                                        <i class="bi bi-at text-muted"></i>
                                    </span>
                                    {{ form.recipient_email }}
                                </div>
                                {% if form.recipient_email.errors %}
                                    <div class="invalid-feedback d-block mt-2">
                                        <i class="bi bi-exclamation-circle me-1"></i>
                                        {% for error in form.recipient_email.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                                <small class="text-muted d-block mt-2">
                                    <i class="bi bi-info-circle me-1"></i>
                                    Enter the email address where you want to send this campaign
                                </small>
                            </div>

                            <!-- Email Template -->
                            <div class="mb-5">
                                <label for="{{ form.email_template.id_for_label }}" class="form-label fw-semibold text-dark fs-6">
                                    <i class="bi bi-file-earmark-text-fill me-2 text-primary"></i>Email Template
                                </label>
                                <div class="input-group input-group-lg">
                                    <span class="input-group-text bg-light border-end-0 rounded-start-3">
                                        <i class="bi bi-layout-text-window-reverse text-muted"></i>
                                    </span>
                                    {{ form.email_template }}
                                </div>
                                {% if form.email_template.errors %}
                                    <div class="invalid-feedback d-block mt-2">
                                        <i class="bi bi-exclamation-circle me-1"></i>
                                        {% for error in form.email_template.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                                <small class="text-muted d-block mt-2">
                                    <i class="bi bi-info-circle me-1"></i>
                                    Choose from our professionally designed email templates
                                </small>
                            </div>

                            <!-- Action Buttons -->
                            <div class="d-flex gap-3 justify-content-center">
                                <a href="{% url 'core:campaign_list' %}" class="btn btn-outline-secondary btn-lg rounded-3 px-4">
                                    <i class="bi bi-arrow-left me-2"></i>Back to Campaigns
                                </a>
                                <button type="submit" class="btn btn-primary btn-lg rounded-3 px-5">
                                    <i class="bi bi-rocket-takeoff me-2"></i>Launch Campaign
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Help Section -->
                <div class="card border-0 bg-light rounded-4 mt-4">
                    <div class="card-body p-4">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <h6 class="fw-semibold mb-2">
                                    <i class="bi bi-lightbulb-fill text-warning me-2"></i>Need Help?
                                </h6>
                                <p class="text-muted mb-0 small">
                                    Learn how to create effective email campaigns and boost your conversion rates with our comprehensive guides.
                                </p>
                            </div>
                            <div class="col-md-4 text-md-end mt-3 mt-md-0">
                                <button class="btn btn-outline-primary btn-sm rounded-3" onclick="showHelpModal()">
                                    <i class="bi bi-question-circle me-2"></i>View Guide
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.form-control {
    border-left: none;
    border-radius: 0 12px 12px 0 !important;
    padding: 16px 20px;
    font-size: 16px;
    transition: var(--transition-smooth);
    background: rgba(255, 255, 255, 0.9);
    border-color: var(--border-light);
}

.form-control:focus {
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15);
    border-color: var(--primary-blue);
    background: #ffffff;
}

.input-group-text {
    border-color: var(--border-light);
    transition: var(--transition-smooth);
}

.form-control:focus + .input-group-text,
.input-group:focus-within .input-group-text {
    border-color: var(--primary-blue);
}

.btn {
    transition: var(--transition-smooth);
    font-weight: 500;
}

.btn:hover {
    transform: translateY(-2px);
}

.btn-primary {
    background: var(--primary-gradient);
    border: none;
    box-shadow: var(--shadow-md);
}

.btn-primary:hover {
    box-shadow: var(--shadow-lg);
}

.card {
    transition: var(--transition-smooth);
}

.card:hover {
    transform: translateY(-2px);
}

#campaign-form button[type="submit"] {
    position: relative;
    overflow: hidden;
}

#campaign-form button[type="submit"]:before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    transition: left 0.5s;
}

#campaign-form button[type="submit"]:hover:before {
    left: 100%;
}
</style>

<script>
function showHelpModal() {
    const modal = document.createElement('div');
    modal.innerHTML = `
        <div class="modal fade" id="helpModal" tabindex="-1">
            <div class="modal-dialog modal-lg modal-dialog-centered">
                <div class="modal-content border-0 rounded-4">
                    <div class="modal-header bg-primary bg-gradient text-white rounded-top-4">
                        <h5 class="modal-title">
                            <i class="bi bi-lightbulb-fill me-2"></i>Campaign Creation Guide
                        </h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body p-4">
                        <div class="row g-4">
                            <div class="col-md-6">
                                <div class="d-flex align-items-start">
                                    <div class="bg-primary bg-gradient text-white rounded-circle me-3 d-flex align-items-center justify-content-center" style="width: 40px; height: 40px; min-width: 40px;">
                                        <i class="bi bi-1-circle-fill"></i>
                                    </div>
                                    <div>
                                        <h6 class="fw-semibold">Choose Your Target</h6>
                                        <p class="text-muted small mb-0">Enter the recipient's email address carefully. Double-check for typos.</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="d-flex align-items-start">
                                    <div class="bg-primary bg-gradient text-white rounded-circle me-3 d-flex align-items-center justify-content-center" style="width: 40px; height: 40px; min-width: 40px;">
                                        <i class="bi bi-2-circle-fill"></i>
                                    </div>
                                    <div>
                                        <h6 class="fw-semibold">Select Template</h6>
                                        <p class="text-muted small mb-0">Pick from our collection of high-converting email templates.</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="d-flex align-items-start">
                                    <div class="bg-success bg-gradient text-white rounded-circle me-3 d-flex align-items-center justify-content-center" style="width: 40px; height: 40px; min-width: 40px;">
                                        <i class="bi bi-3-circle-fill"></i>
                                    </div>
                                    <div>
                                        <h6 class="fw-semibold">Review & Launch</h6>
                                        <p class="text-muted small mb-0">Double-check your settings before launching your campaign.</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="d-flex align-items-start">
                                    <div class="bg-info bg-gradient text-white rounded-circle me-3 d-flex align-items-center justify-content-center" style="width: 40px; height: 40px; min-width: 40px;">
                                        <i class="bi bi-4-circle-fill"></i>
                                    </div>
                                    <div>
                                        <h6 class="fw-semibold">Track Performance</h6>
                                        <p class="text-muted small mb-0">Monitor your campaign's success with detailed analytics.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer border-0">
                        <button type="button" class="btn btn-primary rounded-3" data-bs-dismiss="modal">
                            <i class="bi bi-check-circle me-2"></i>Got it!
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
    
    const modalInstance = new bootstrap.Modal(document.getElementById('helpModal'));
    modalInstance.show();
    
    document.getElementById('helpModal').addEventListener('hidden.bs.modal', function () {
        document.body.removeChild(modal);
    });
}

// Add form validation and loading states
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('campaign-form');
    
    form.addEventListener('submit', function(e) {
        const submitBtn = form.querySelector('button[type="submit"]');
        submitBtn.innerHTML = '<i class="bi bi-hourglass-split me-2"></i>Launching...';
        submitBtn.disabled = true;
        
        // Re-enable after 5 seconds in case of error
        setTimeout(() => {
            submitBtn.innerHTML = '<i class="bi bi-rocket-takeoff me-2"></i>Launch Campaign';
            submitBtn.disabled = false;
        }, 5000);
    });
});
</script>
{% endblock %}
